---
#
# Media center
#
# This builds a media center using XBMC & LTSP. At the end you should have the following
# - Main server with XBMC and lots of software for work, rest and play
# - Fat clients booting from the main server with XBMC and some software for basic browsing/email.
#
- hosts: xbmc
  user: map7
  sudo: yes
  vars:
    main_user: xbmc
  vars_files:
    - "vars/defaults.yml"
    - "vars/$ansible_distribution-$ansible_architecture.yml"
    - "vars/$ansible_distribution.yml"

  # Tasks for XBMC are put in a specific order
  tasks:
    - include: common/tasks/system.yml
    - include: common/tasks/office.yml      
    - include: common/tasks/xbmc.yml
    - include: common/tasks/nvidia.yml
    - include: common/tasks/ltsp.yml
    - include: common/tasks/ltsp-fat-client.yml
    - include: common/tasks/ltsp-build.yml
    
    # Autologin
    - name: Set Automatic login
      lineinfile:
        dest=/etc/gdm3/daemon.conf
        regexp="^#.*AutomaticLoginEnable.*"
        insertafter="^[daemon]"
        line="AutomaticLoginEnable=true"
        state=present
      lineinfile:
        dest=/etc/gdm3/daemon.conf
        regexp="^#.*AutomaticLogin.*"
        insertafter="^AutomaticLoginEnable.*"
        line="AutomaticLogin=$main_user"
        state=present
